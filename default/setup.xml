<setup>
  <block title="MITRE ATT&amp;CK App for Splunk - Initial Setup">
    <text>
      This setup page provides configuration options for API integration and Lookup Generating searches.
      &lt;br /&gt;&lt;br /&gt;
      You can find more information on &lt;a href="https://api.seynur.com" target="_blank" &gt;https://api.seynur.com&lt;/a&gt;
      &lt;br /&gt;&lt;br /&gt;
      For a quick start simply hit Save button to continue
      &lt;br /&gt;&lt;br /&gt;

      &lt;b&gt;Note:&lt;/b&gt; "Get Attack Detection Rules" search tries to connect to API gateway
      &lt;br /&gt;&lt;hr&gt;&lt;br /&gt;
    </text>
  </block>
    <block title="Attack Detection API Key" endpoint="storage/passwords" entity="attackdetection_apikey*" mode="iter" eai_strict="false">
    <input field="password">
      <label>API Key</label>
      <type>text</type>
    </input>
  </block>
  <block title="Enable/Disable API and Lookup generating searches."
    endpoint="saved/searches" entity="MITRE ATT&amp;CK*">
    <text>
      &lt;i&gt;These are saved searches and can also be modified via Settings after setup.&lt;/i&gt;
    </text>

    <!-- The field "is_scheduled" maps to the enableSched setting in savedsearches.conf -->
    <input field="is_scheduled">
      <label>$name$</label>
      <type>bool</type>
    </input>
  </block>
  <block title="Configure Cron Schedule"
    endpoint="saved/searches" entity="MITRE ATT&amp;CK*" mode="iter">
    <text>
      &lt;i&gt;Only applicable if enabled.  These are saved searches and can also be modified via Settings after setup.&lt;/i&gt;
    </text>
    <input field="cron_schedule">
        <label>$name$</label>
        <type>text</type>
      </input>
  </block>
  <block title="Configure Enterprise Security Integration" endpoint="configs/conf-macros" entity="(^mitre_use_es$|^mitre_rules$)" mode="iter">
    <text>
      &lt;i&gt;Using Enterprise Security Application is strongly recommended.  However, if you'd like to use Alert Manager instead, please uncheck the following checkbox. (Note: Form field values will update automatically according to checkbox.)&lt;/i&gt;
      &lt;p/&gt;
      &lt;div&gt;
      &lt;label for="use_es_check"&gt;Use Enterprise Security App:&lt;/label&gt;
      &lt;input type="checkbox" id="use_es_check" onclick="updateMacroConfig()" checked&gt;
      &lt;style onload="updateCheckboxStatus()"&gt;p {color:#353637;}&lt;/style&gt;
      &lt;/div&gt;

      &lt;script&gt;
      function updateCheckboxStatus() {
        var checkBox = document.getElementById("use_es_check");
        var mitreUseES = document.getElementById("/configs/conf-macros/mitre_use_es/definition_id");
	if (mitreUseES.value == "\"1\"") {
          checkBox.checked = true;
        } else {
          checkBox.checked = false;
        }
      }
      function updateMacroConfig() {
        var checkBox = document.getElementById("use_es_check");
        var mitreRules = document.getElementById("/configs/conf-macros/mitre_rules/definition_id");
        var mitreUseES = document.getElementById("/configs/conf-macros/mitre_use_es/definition_id");
        if (checkBox.checked == true){
          mitreUseES.value="\"1\""
          mitreRules.value="`mitre_rules_from_notable`"
        } else {
         mitreUseES.value="\"0\""
         mitreRules.value="`mitre_rules_from_alerts`"
        }
      }
      &lt;/script&gt;

    </text>
    <input field="definition">
        <label>$name$</label>
        <type>text</type>
    </input>
  </block>
</setup>
