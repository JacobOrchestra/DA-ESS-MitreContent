<form script="table_cell_highlighting_attack.js" stylesheet="table_cell_highlighting_attack.css">
  <label>Mitre Att&amp;ck Framework Triggered Technics</label>
  <fieldset submitButton="true">
    <input type="time" token="field1">
      <label></label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
  </fieldset>
  <row>
    <panel>
      <table id="highlight">
        <search>
          <query>| inputlookup mitre_lookup.csv 
| join "Collection" type=left [| rest /services/configs/conf-analyticstories 
      | where annotations!=""
      | spath input=annotations path=mitre_attack{} output=mitre_attack 
      | eval rule_name=ltrim(title,"savedsearch://") 
      | fields rule_name,mitre_attack
      | mvexpand mitre_attack 
      | fields title,rule_name,mitre_attack
      | join rule_name [search  `notable` | rename search_name as rule_name | fields rule_name | stats count by rule_name]
      | stats sum by mitre_attack
      | rename sum(count) as triggered_count
      | rename mitre_attack as "Collection", triggered_count as "Collection Attack Count" ]
      | fillnull value="NULL" "Collection","Collection Attack Count" | eval "Collection"='Collection'. "|" .'Collection Attack Count'
| join "Command And Control" type=left [| rest /services/configs/conf-analyticstories 
      | where annotations!=""
      | spath input=annotations path=mitre_attack{} output=mitre_attack 
      | eval rule_name=ltrim(title,"savedsearch://") 
      | fields rule_name,mitre_attack
      | mvexpand mitre_attack 
      | fields title,rule_name,mitre_attack
      | join rule_name [search  `notable` | rename search_name as rule_name | fields rule_name | stats count by rule_name]
      | stats sum by mitre_attack
      | rename sum(count) as triggered_count
      | rename mitre_attack as "Command And Control", triggered_count as "Command And Control Attack Count" ]
      | fillnull value="NULL" "Command And Control","Command And Control Attack Count" | eval "Command And Control"='Command And Control'. "|" .'Command And Control Attack Count'
| join "Credential Access" type=left [| rest /services/configs/conf-analyticstories 
      | where annotations!=""
      | spath input=annotations path=mitre_attack{} output=mitre_attack 
      | eval rule_name=ltrim(title,"savedsearch://") 
      | fields rule_name,mitre_attack
      | mvexpand mitre_attack 
      | fields title,rule_name,mitre_attack
      | join rule_name [search  `notable` | rename search_name as rule_name | fields rule_name | stats count by rule_name]
      | stats sum by mitre_attack
      | rename sum(count) as triggered_count
      | rename mitre_attack as "Credential Access", triggered_count as "Credential Access Attack Count" ]
      | fillnull value="NULL" "Credential Access","Credential Access Attack Count" | eval "Credential Access"='Credential Access'. "|" .'Credential Access Attack Count'
| join "Defense Evasion" type=left [| rest /services/configs/conf-analyticstories 
      | where annotations!=""
      | spath input=annotations path=mitre_attack{} output=mitre_attack 
      | eval rule_name=ltrim(title,"savedsearch://") 
      | fields rule_name,mitre_attack
      | mvexpand mitre_attack 
      | fields title,rule_name,mitre_attack
      | join rule_name [search  `notable` | rename search_name as rule_name | fields rule_name | stats count by rule_name]
      | stats sum by mitre_attack
      | rename sum(count) as triggered_count
      | rename mitre_attack as "Defense Evasion", triggered_count as "Defense Evasion Attack Count" ]
      | fillnull value="NULL" "Defense Evasion","Defense Evasion Attack Count" | eval "Defense Evasion"='Defense Evasion'. "|" .'Defense Evasion Attack Count'
| join "Discovery" type=left [| rest /services/configs/conf-analyticstories 
      | where annotations!=""
      | spath input=annotations path=mitre_attack{} output=mitre_attack 
      | eval rule_name=ltrim(title,"savedsearch://") 
      | fields rule_name,mitre_attack
      | mvexpand mitre_attack 
      | fields title,rule_name,mitre_attack
      | join rule_name [search  `notable` | rename search_name as rule_name | fields rule_name | stats count by rule_name]
      | stats sum by mitre_attack
      | rename sum(count) as triggered_count
      | rename mitre_attack as "Discovery", triggered_count as "Discovery Attack Count" ]
      | fillnull value="NULL" "Discovery","Discovery Attack Count" | eval "Discovery"='Discovery'. "|" .'Discovery Attack Count'
| join "Execution" type=left [| rest /services/configs/conf-analyticstories 
      | where annotations!=""
      | spath input=annotations path=mitre_attack{} output=mitre_attack 
      | eval rule_name=ltrim(title,"savedsearch://") 
      | fields rule_name,mitre_attack
      | mvexpand mitre_attack 
      | fields title,rule_name,mitre_attack
      | join rule_name [search  `notable` | rename search_name as rule_name | fields rule_name | stats count by rule_name]
      | stats sum by mitre_attack
      | rename sum(count) as triggered_count
      | rename mitre_attack as "Execution", triggered_count as "Execution Attack Count" ]
      | fillnull value="NULL" "Execution","Execution Attack Count" | eval "Execution"='Execution'. "|" .'Execution Attack Count'
| join "Exfiltration" type=left [| rest /services/configs/conf-analyticstories 
      | where annotations!=""
      | spath input=annotations path=mitre_attack{} output=mitre_attack 
      | eval rule_name=ltrim(title,"savedsearch://") 
      | fields rule_name,mitre_attack
      | mvexpand mitre_attack 
      | fields title,rule_name,mitre_attack
      | join rule_name [search  `notable` | rename search_name as rule_name | fields rule_name | stats count by rule_name]
      | stats sum by mitre_attack
      | rename sum(count) as triggered_count
      | rename mitre_attack as "Exfiltration", triggered_count as "Exfiltration Attack Count" ]
      | fillnull value="NULL" "Exfiltration","Exfiltration Attack Count" | eval "Exfiltration"='Exfiltration'. "|" .'Exfiltration Attack Count'
| join "Impact" type=left [| rest /services/configs/conf-analyticstories 
      | where annotations!=""
      | spath input=annotations path=mitre_attack{} output=mitre_attack 
      | eval rule_name=ltrim(title,"savedsearch://") 
      | fields rule_name,mitre_attack
      | mvexpand mitre_attack 
      | fields title,rule_name,mitre_attack
      | join rule_name [search  `notable` | rename search_name as rule_name | fields rule_name | stats count by rule_name]
      | stats sum by mitre_attack
      | rename sum(count) as triggered_count
      | rename mitre_attack as "Impact", triggered_count as "Impact Attack Count" ]
      | fillnull value="NULL" "Impact","Impact Attack Count" | eval "Impact"='Impact'. "|" .'Impact Attack Count'
| join "Initial Access" type=left [| rest /services/configs/conf-analyticstories 
      | where annotations!=""
      | spath input=annotations path=mitre_attack{} output=mitre_attack 
      | eval rule_name=ltrim(title,"savedsearch://") 
      | fields rule_name,mitre_attack
      | mvexpand mitre_attack 
      | fields title,rule_name,mitre_attack
      | join rule_name [search  `notable` | rename search_name as rule_name | fields rule_name | stats count by rule_name]
      | stats sum by mitre_attack
      | rename sum(count) as triggered_count
      | rename mitre_attack as "Initial Access", triggered_count as "Initial Access Attack Count" ]
      | fillnull value="NULL" "Initial Access","Initial Access Attack Count" | eval "Initial Access"='Initial Access'. "|" .'Initial Access Attack Count'
| join "Lateral Movement" type=left [| rest /services/configs/conf-analyticstories 
      | where annotations!=""
      | spath input=annotations path=mitre_attack{} output=mitre_attack 
      | eval rule_name=ltrim(title,"savedsearch://") 
      | fields rule_name,mitre_attack
      | mvexpand mitre_attack 
      | fields title,rule_name,mitre_attack
      | join rule_name [search  `notable` | rename search_name as rule_name | fields rule_name | stats count by rule_name]
      | stats sum by mitre_attack
      | rename sum(count) as triggered_count
      | rename mitre_attack as "Lateral Movement", triggered_count as "Lateral Movement Attack Count" ]
      | fillnull value="NULL" "Lateral Movement","Lateral Movement Attack Count" | eval "Lateral Movement"='Lateral Movement'. "|" .'Lateral Movement Attack Count'
| join "Persistence" type=left [| rest /services/configs/conf-analyticstories 
      | where annotations!=""
      | spath input=annotations path=mitre_attack{} output=mitre_attack 
      | eval rule_name=ltrim(title,"savedsearch://") 
      | fields rule_name,mitre_attack
      | mvexpand mitre_attack 
      | fields title,rule_name,mitre_attack
      | join rule_name [search  `notable` | rename search_name as rule_name | fields rule_name | stats count by rule_name]
      | stats sum by mitre_attack
      | rename sum(count) as triggered_count
      | rename mitre_attack as "Persistence", triggered_count as "Persistence Attack Count" ]
      | fillnull value="NULL" "Persistence","Persistence Attack Count" | eval "Persistence"='Persistence'. "|" .'Persistence Attack Count'
| join "Privilege Escalation" type=left [| rest /services/configs/conf-analyticstories 
      | where annotations!=""
      | spath input=annotations path=mitre_attack{} output=mitre_attack 
      | eval rule_name=ltrim(title,"savedsearch://") 
      | fields rule_name,mitre_attack
      | mvexpand mitre_attack 
      | fields title,rule_name,mitre_attack
      | join rule_name [search  `notable` | rename search_name as rule_name | fields rule_name | stats count by rule_name]
      | stats sum by mitre_attack
      | rename sum(count) as triggered_count
      | rename mitre_attack as "Privilege Escalation", triggered_count as "Privilege Escalation Attack Count" ]
      | fillnull value="NULL" "Privilege Escalation","Privilege Escalation Attack Count" | eval "Privilege Escalation"='Privilege Escalation'. "|" .'Privilege Escalation Attack Count'</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="count">100</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <fields>["Collection","Command And Control","Credential Access","Defense Evasion","Discovery","Execution","Exfiltration","Impact","Initial Access","Lateral Movement","Persistence","Privilege Escalation"]</fields>
      </table>
    </panel>
  </row>
</form>