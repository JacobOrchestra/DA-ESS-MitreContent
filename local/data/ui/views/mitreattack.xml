<form script="table_cell_highlighting_attack.js" stylesheet="table_cell_highlighting_attack.css">
  <label>Mitre Att&amp;ck Framework Triggered Technics</label>
  <fieldset submitButton="true">
    <input type="time" token="field1">
      <label></label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
  </fieldset>
  <row>
    <panel>
      <table id="highlight">
        <search>
          <query>| inputlookup mitre_lookup.csv 
| join "dummy" type=left [| rest /services/configs/conf-analyticstories 
      | where annotations!=""
      | spath input=annotations path=mitre_attack{} output=mitre_attack 
      | eval rule_name=ltrim(title,"savedsearch://") 
      | fields rule_name,mitre_attack
      | mvexpand mitre_attack 
      | fields title,rule_name,mitre_attack
      | join rule_name [search  `notable` | rename search_name as rule_name | fields rule_name | stats count by rule_name]
      | stats sum by mitre_attack
      | rename sum(count) as triggered_count
      | outputlookup notable_mitre_result.csv]
| fields "Collection","Command And Control","Credential Access","Defense Evasion","Discovery","Execution","Exfiltration","Impact","Initial Access","Lateral Movement","Persistence","Privilege Escalation"

| lookup notable_mitre_result.csv mitre_attack as "Collection" OUTPUTNEW triggered_count as "Collection Attack Count"
| fillnull value="NULL" "Collection","Collection Attack Count" | eval "Collection"='Collection'. "|" .'Collection Attack Count'  

| lookup notable_mitre_result.csv mitre_attack as "Command And Control" OUTPUTNEW triggered_count as "Command And Control Attack Count"
| fillnull value="NULL" "Command And Control","Command And Control Attack Count" | eval "Command And Control"='Command And Control'. "|" .'Command And Control Attack Count' 

| lookup notable_mitre_result.csv mitre_attack as "Credential Access" OUTPUTNEW triggered_count as "Credential Access Attack Count"
| fillnull value="NULL" "Credential Access","Credential Access Attack Count" | eval "Credential Access"='Credential Access'. "|" .'Credential Access Attack Count'  

| lookup notable_mitre_result.csv mitre_attack as "Defense Evasion" OUTPUTNEW triggered_count as "Defense Evasion Attack Count"
| fillnull value="NULL" "Defense Evasion","Defense Evasion Attack Count" | eval "Defense Evasion"='Defense Evasion'. "|" .'Defense Evasion Attack Count'  

| lookup notable_mitre_result.csv mitre_attack as "Discovery" OUTPUTNEW triggered_count as "Discovery Attack Count"
| fillnull value="NULL" "Discovery","Discovery Attack Count" | eval "Discovery"='Discovery'. "|" .'Discovery Attack Count'  

| lookup notable_mitre_result.csv mitre_attack as "Execution" OUTPUTNEW triggered_count as "Execution Attack Count"
| fillnull value="NULL" "Execution","Execution Attack Count" | eval "Execution"='Execution'. "|" .'Execution Attack Count'  

| lookup notable_mitre_result.csv mitre_attack as "Exfiltration" OUTPUTNEW triggered_count as "Exfiltration Attack Count"
| fillnull value="NULL" "Exfiltration","Exfiltration Attack Count" | eval "Exfiltration"='Exfiltration'. "|" .'Exfiltration Attack Count'  

| lookup notable_mitre_result.csv mitre_attack as "Impact" OUTPUTNEW triggered_count as "Impact Attack Count"
| fillnull value="NULL" "Impact","Impact Attack Count" | eval "Impact"='Impact'. "|" .'Impact Attack Count'  

| lookup notable_mitre_result.csv mitre_attack as "Initial Access" OUTPUTNEW triggered_count as "Initial Access Attack Count"
| fillnull value="NULL" "Initial Access","Initial Access Attack Count" | eval "Initial Access"='Initial Access'. "|" .'Initial Access Attack Count'  

| lookup notable_mitre_result.csv mitre_attack as "Lateral Movement" OUTPUTNEW triggered_count as "Lateral Movement Attack Count"
| fillnull value="NULL" "Lateral Movement","Lateral Movement Attack Count" | eval "Lateral Movement"='Lateral Movement'. "|" .'Lateral Movement Attack Count'  

| lookup notable_mitre_result.csv mitre_attack as "Persistence" OUTPUTNEW triggered_count as "Persistence Attack Count"
| fillnull value="NULL" "Persistence","Persistence Attack Count" | eval "Persistence"='Persistence'. "|" .'Persistence Attack Count'  

| lookup notable_mitre_result.csv mitre_attack as "Privilege Escalation" OUTPUTNEW triggered_count as "Privilege Escalation Attack Count"
| fillnull value="NULL" "Privilege Escalation","Privilege Escalation Attack Count" | eval "Privilege Escalation"='Privilege Escalation'. "|" .'Privilege Escalation Attack Count'  

| fields "Collection","Command And Control","Credential Access","Defense Evasion","Discovery","Execution","Exfiltration","Impact","Initial Access","Lateral Movement","Persistence","Privilege Escalation"</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="count">100</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <fields>["Collection","Command And Control","Credential Access","Defense Evasion","Discovery","Execution","Exfiltration","Impact","Initial Access","Lateral Movement","Persistence","Privilege Escalation"]</fields>
      </table>
    </panel>
  </row>
</form>